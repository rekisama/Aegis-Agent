# åŠ¨æ€å·¥å…·åˆ›å»ºç³»ç»Ÿ

Aegis Agentçš„åŠ¨æ€å·¥å…·åˆ›å»ºç³»ç»Ÿå…è®¸Agentåœ¨è¿è¡Œæ—¶è‡ªåŠ¨åˆ›å»ºã€ç®¡ç†å’Œä½¿ç”¨è‡ªå®šä¹‰å·¥å…·ï¼Œå®ç°çœŸæ­£çš„è‡ªæˆ‘è¿›åŒ–èƒ½åŠ›ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸš€ æ ¸å¿ƒåŠŸèƒ½
- **è‡ªåŠ¨å·¥å…·åˆ›å»º**: Agentèƒ½å¤Ÿåˆ†æä»»åŠ¡éœ€æ±‚å¹¶è‡ªåŠ¨åˆ›å»ºæ–°å·¥å…·
- **å®‰å…¨éªŒè¯**: ä½¿ç”¨LLMéªŒè¯å·¥å…·ä»£ç çš„å®‰å…¨æ€§
- **å®æ—¶ç›‘æ§**: æ–‡ä»¶ç³»ç»Ÿç›‘æ§æ”¯æŒçƒ­åŠ è½½å·¥å…·
- **Webç®¡ç†ç•Œé¢**: å®Œæ•´çš„Webç•Œé¢ç”¨äºå·¥å…·ç®¡ç†
- **ç»Ÿè®¡è·Ÿè¸ª**: å·¥å…·ä½¿ç”¨ç»Ÿè®¡å’ŒæˆåŠŸç‡è·Ÿè¸ª

### ğŸ›¡ï¸ å®‰å…¨æœºåˆ¶
- **ä»£ç å®‰å…¨æ£€æŸ¥**: æ£€æµ‹å±é™©æ“ä½œï¼ˆæ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œã€ç³»ç»Ÿè°ƒç”¨ç­‰ï¼‰
- **å‚æ•°éªŒè¯**: éªŒè¯å·¥å…·å‚æ•°çš„ç±»å‹å’ŒèŒƒå›´
- **æ²™ç®±æ‰§è¡Œ**: åœ¨éš”ç¦»ç¯å¢ƒä¸­æ‰§è¡ŒåŠ¨æ€ä»£ç 
- **LLMéªŒè¯**: ä½¿ç”¨å¤§è¯­è¨€æ¨¡å‹éªŒè¯å·¥å…·è§„èŒƒ

### ğŸ“Š ç®¡ç†åŠŸèƒ½
- **å·¥å…·åˆ›å»º**: é€šè¿‡Webç•Œé¢æˆ–APIåˆ›å»ºæ–°å·¥å…·
- **å·¥å…·åˆ—è¡¨**: æŸ¥çœ‹æ‰€æœ‰åŠ¨æ€å·¥å…·åŠå…¶ç»Ÿè®¡ä¿¡æ¯
- **å·¥å…·æµ‹è¯•**: åœ¨çº¿æµ‹è¯•å·¥å…·åŠŸèƒ½
- **å·¥å…·åˆ é™¤**: å®‰å…¨åˆ é™¤ä¸éœ€è¦çš„å·¥å…·

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Agent Core    â”‚    â”‚ Dynamic Tool    â”‚    â”‚   Web Interface â”‚
â”‚                 â”‚    â”‚   Creator       â”‚    â”‚                 â”‚
â”‚ - ä»»åŠ¡åˆ†æ      â”‚â—„â”€â”€â–ºâ”‚ - å·¥å…·åˆ›å»º      â”‚â—„â”€â”€â–ºâ”‚ - å·¥å…·ç®¡ç†      â”‚
â”‚ - å·¥å…·æ‰§è¡Œ      â”‚    â”‚ - å®‰å…¨éªŒè¯      â”‚    â”‚ - åˆ›å»ºè¡¨å•      â”‚
â”‚ - ç»“æœç”Ÿæˆ      â”‚    â”‚ - æ–‡ä»¶ç›‘æ§      â”‚    â”‚ - å·¥å…·åˆ—è¡¨      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Tool Files    â”‚    â”‚   Metadata      â”‚    â”‚   API Endpoints â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ - Pythonä»£ç     â”‚    â”‚ - JSONé…ç½®      â”‚    â”‚ - REST API      â”‚
â”‚ - å·¥å…·ç±»        â”‚    â”‚ - ç»Ÿè®¡ä¿¡æ¯      â”‚    â”‚ - WebSocket     â”‚
â”‚ - å…ƒæ•°æ®        â”‚    â”‚ - ä½¿ç”¨è®°å½•      â”‚    â”‚ - å®æ—¶é€šçŸ¥      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 2. å¯åŠ¨WebæœåŠ¡å™¨

```bash
python web/start_server.py
```

è®¿é—® http://localhost:8000 æŸ¥çœ‹Webç•Œé¢ã€‚

### 3. è¿è¡Œæ¼”ç¤º

```bash
python examples/dynamic_tool_creation_demo.py
```

## ä½¿ç”¨æ–¹æ³•

### é€šè¿‡Webç•Œé¢åˆ›å»ºå·¥å…·

1. æ‰“å¼€Webç•Œé¢ï¼Œç‚¹å‡»ä¾§è¾¹æ çš„"å·¥å…·ç®¡ç†"æŒ‰é’®
2. å¡«å†™å·¥å…·ä¿¡æ¯ï¼š
   - **å·¥å…·åç§°**: ä¾‹å¦‚ `calculator`
   - **å·¥å…·æè¿°**: æè¿°å·¥å…·çš„åŠŸèƒ½
   - **Pythonä»£ç **: å®ç°å·¥å…·åŠŸèƒ½çš„ä»£ç 
   - **å‚æ•°å®šä¹‰**: JSONæ ¼å¼çš„å‚æ•°è¯´æ˜
3. ç‚¹å‡»"åˆ›å»ºå·¥å…·"æŒ‰é’®

### é€šè¿‡APIåˆ›å»ºå·¥å…·

```python
import requests

tool_spec = {
    "name": "calculator",
    "description": "ç®€å•è®¡ç®—å™¨",
    "code": """
def calculate(a, b, operation):
    if operation == 'add':
        return a + b
    elif operation == 'subtract':
        return a - b
    elif operation == 'multiply':
        return a * b
    elif operation == 'divide':
        return a / b if b != 0 else 'Error: Division by zero'
    else:
        return 'Error: Unknown operation'

result = calculate(a, b, operation)
""",
    "parameters": {
        "a": "ç¬¬ä¸€ä¸ªæ•°å­—",
        "b": "ç¬¬äºŒä¸ªæ•°å­—",
        "operation": "æ“ä½œç±»å‹ (add/subtract/multiply/divide)"
    }
}

response = requests.post('http://localhost:8000/api/tools/create', json=tool_spec)
print(response.json())
```

### é€šè¿‡Agentè‡ªåŠ¨åˆ›å»º

Agentä¼šåœ¨æ‰§è¡Œä»»åŠ¡æ—¶è‡ªåŠ¨åˆ†ææ˜¯å¦éœ€è¦åˆ›å»ºæ–°å·¥å…·ï¼š

```python
from python.agent.core import Agent

agent = Agent()
result = await agent.execute_task("å¸®æˆ‘åˆ›å»ºä¸€ä¸ªå·¥å…·ï¼Œå¯ä»¥è®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—çš„ç¬¬né¡¹")
```

## APIå‚è€ƒ

### å·¥å…·ç®¡ç†API

#### åˆ›å»ºå·¥å…·
```http
POST /api/tools/create
Content-Type: application/json

{
    "name": "tool_name",
    "description": "å·¥å…·æè¿°",
    "code": "Pythonä»£ç ",
    "parameters": {
        "param1": "å‚æ•°æè¿°"
    }
}
```

#### è·å–å·¥å…·åˆ—è¡¨
```http
GET /api/tools/dynamic
```

#### åˆ é™¤å·¥å…·
```http
DELETE /api/tools/dynamic/{tool_name}
```

#### æµ‹è¯•å·¥å…·
```http
POST /api/tools/dynamic/{tool_name}/test
Content-Type: application/json

{
    "param1": "value1",
    "param2": "value2"
}
```

#### è·å–å·¥å…·ä¿¡æ¯
```http
GET /api/tools/dynamic/{tool_name}/info
```

## å·¥å…·ä»£ç è§„èŒƒ

### åŸºæœ¬ç»“æ„

```python
"""
Dynamic Tool: {tool_name}
Auto-generated by Agent
"""

import json
import logging
from typing import Dict, Any
from python.tools.base import BaseTool, ToolResult

class Dynamic{tool_name_capitalized}Tool(BaseTool):
    """Dynamic tool: {tool_name}"""
    
    def __init__(self):
        super().__init__()
        self.name = "{tool_name}"
        self.description = "Dynamic tool created by agent"
    
    async def execute(self, **kwargs) -> ToolResult:
        """Execute the dynamic tool"""
        try:
            # å‚æ•°éªŒè¯
            validated_params = self._validate_parameters(kwargs)
            
            # æ‰§è¡ŒåŠ¨æ€ä»£ç 
            result = self._execute_dynamic_code(validated_params)
            
            return ToolResult(
                success=True,
                data={"result": result},
                error=None
            )
            
        except Exception as e:
            return ToolResult(
                success=False,
                data={},
                error=str(e)
            )
```

### å®‰å…¨è¦æ±‚

1. **ç¦æ­¢çš„æ“ä½œ**:
   - `import os`, `import sys`, `import subprocess`
   - `eval()`, `exec()`, `__import__()`
   - æ–‡ä»¶ç³»ç»Ÿæ“ä½œ (`open()`, `file()`)
   - ç½‘ç»œè¯·æ±‚
   - ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œ

2. **å‚æ•°éªŒè¯**:
   - æ£€æŸ¥å‚æ•°ç±»å‹
   - é™åˆ¶å­—ç¬¦ä¸²é•¿åº¦
   - é™åˆ¶åˆ—è¡¨å¤§å°
   - é™åˆ¶å­—å…¸æ·±åº¦

3. **é”™è¯¯å¤„ç†**:
   - æ•è·æ‰€æœ‰å¼‚å¸¸
   - è¿”å›æœ‰æ„ä¹‰çš„é”™è¯¯ä¿¡æ¯
   - ä¸æš´éœ²ç³»ç»Ÿä¿¡æ¯

## æ–‡ä»¶ç»“æ„

```
python/
â”œâ”€â”€ agent/
â”‚   â”œâ”€â”€ core.py                    # Agentæ ¸å¿ƒï¼ŒåŒ…å«åŠ¨æ€å·¥å…·åˆ›å»ºé€»è¾‘
â”‚   â””â”€â”€ dynamic_tool_creator.py    # åŠ¨æ€å·¥å…·åˆ›å»ºå™¨
â”œâ”€â”€ tools/
â”‚   â””â”€â”€ dynamic/                   # åŠ¨æ€å·¥å…·ç›®å½•
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ dynamic_hello_world.py # ç¤ºä¾‹å·¥å…·
â”‚       â””â”€â”€ dynamic_mock_tool.py   # ç¤ºä¾‹å·¥å…·
web/
â”œâ”€â”€ main.py                        # WebæœåŠ¡å™¨ï¼ŒåŒ…å«å·¥å…·ç®¡ç†API
â””â”€â”€ templates/
    â””â”€â”€ index.html                 # Webç•Œé¢ï¼ŒåŒ…å«å·¥å…·ç®¡ç†ç•Œé¢
examples/
â””â”€â”€ dynamic_tool_creation_demo.py  # æ¼”ç¤ºè„šæœ¬
```

## ç›‘æ§å’Œæ—¥å¿—

### æ–‡ä»¶ç³»ç»Ÿç›‘æ§

ç³»ç»Ÿä¼šè‡ªåŠ¨ç›‘æ§ `python/tools/dynamic/` ç›®å½•çš„å˜åŒ–ï¼š

- **æ–‡ä»¶åˆ›å»º**: è‡ªåŠ¨åŠ è½½æ–°å·¥å…·
- **æ–‡ä»¶ä¿®æ”¹**: é‡æ–°åŠ è½½å·¥å…·
- **æ–‡ä»¶åˆ é™¤**: ä»å†…å­˜ä¸­ç§»é™¤å·¥å…·

### æ—¥å¿—è®°å½•

```python
import logging

# æŸ¥çœ‹å·¥å…·åˆ›å»ºæ—¥å¿—
logging.info("Created dynamic tool: calculator")

# æŸ¥çœ‹å·¥å…·æ‰§è¡Œæ—¥å¿—
logging.info("Tool calculator executed successfully")

# æŸ¥çœ‹å®‰å…¨éªŒè¯æ—¥å¿—
logging.warning("Dangerous keyword found in code: import os")
```

### ç»Ÿè®¡ä¿¡æ¯

```python
# è·å–å·¥å…·ç»Ÿè®¡
stats = agent.dynamic_tool_creator.get_tool_statistics()
print(stats)
# è¾“å‡º:
# {
#     "total_dynamic_tools": 3,
#     "total_usage": 15,
#     "average_success_rate": 0.93,
#     "tools": [...]
# }
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å·¥å…·åˆ›å»ºå¤±è´¥**
   - æ£€æŸ¥ä»£ç è¯­æ³•
   - éªŒè¯å‚æ•°å®šä¹‰
   - æŸ¥çœ‹å®‰å…¨éªŒè¯ç»“æœ

2. **å·¥å…·æ‰§è¡Œé”™è¯¯**
   - æ£€æŸ¥å‚æ•°ç±»å‹
   - éªŒè¯ä»£ç é€»è¾‘
   - æŸ¥çœ‹é”™è¯¯æ—¥å¿—

3. **æ–‡ä»¶ç›‘æ§ä¸å·¥ä½œ**
   - ç¡®ä¿å®‰è£…äº† `watchdog` åŒ…
   - æ£€æŸ¥ç›®å½•æƒé™
   - æŸ¥çœ‹ç›‘æ§æ—¥å¿—

### è°ƒè¯•æ¨¡å¼

```python
import logging
logging.basicConfig(level=logging.DEBUG)

# å¯ç”¨è¯¦ç»†æ—¥å¿—
agent = Agent(config)
agent.dynamic_tool_creator.debug = True
```

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„å·¥å…·ç±»å‹

1. åˆ›å»ºå·¥å…·ç±»æ–‡ä»¶
2. ç»§æ‰¿ `BaseTool` ç±»
3. å®ç° `execute` æ–¹æ³•
4. æ·»åŠ å®‰å…¨éªŒè¯

### è‡ªå®šä¹‰éªŒè¯è§„åˆ™

```python
def custom_validation_rules(code: str) -> bool:
    # æ·»åŠ è‡ªå®šä¹‰éªŒè¯é€»è¾‘
    dangerous_patterns = [
        r'import\s+os',
        r'import\s+sys',
        r'eval\(',
        r'exec\(',
    ]
    
    for pattern in dangerous_patterns:
        if re.search(pattern, code, re.IGNORECASE):
            return False
    
    return True
```

### é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿ

```python
# åœ¨ç°æœ‰çš„Agentç³»ç»Ÿä¸­é›†æˆ
from python.agent.dynamic_tool_creator import DynamicToolCreator

class CustomAgent(Agent):
    def __init__(self):
        super().__init__()
        self.dynamic_tool_creator = DynamicToolCreator()
    
    async def create_custom_tool(self, spec):
        return await self.dynamic_tool_creator.create_tool_from_spec(spec)
```

## æ€§èƒ½ä¼˜åŒ–

### å·¥å…·ç¼“å­˜

```python
# å¯ç”¨å·¥å…·ç¼“å­˜
agent.dynamic_tool_creator.enable_caching = True
```

### å¹¶è¡Œæ‰§è¡Œ

```python
# å¹¶è¡Œåˆ›å»ºå¤šä¸ªå·¥å…·
import asyncio

async def create_multiple_tools(specs):
    tasks = [agent.create_new_tool(spec) for spec in specs]
    results = await asyncio.gather(*tasks)
    return results
```

## å®‰å…¨æœ€ä½³å®è·µ

1. **ä»£ç å®¡æŸ¥**: å®šæœŸå®¡æŸ¥åŠ¨æ€åˆ›å»ºçš„ä»£ç 
2. **æƒé™æ§åˆ¶**: é™åˆ¶å·¥å…·çš„æ‰§è¡Œæƒé™
3. **èµ„æºé™åˆ¶**: é™åˆ¶å·¥å…·çš„å†…å­˜å’ŒCPUä½¿ç”¨
4. **æ—¥å¿—å®¡è®¡**: è®°å½•æ‰€æœ‰å·¥å…·åˆ›å»ºå’Œæ‰§è¡Œæ“ä½œ
5. **å®šæœŸæ›´æ–°**: æ›´æ–°å®‰å…¨éªŒè¯è§„åˆ™

## è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚ 